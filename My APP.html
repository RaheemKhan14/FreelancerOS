import React, { useState, useEffect } from 'react';
import { 
  LayoutDashboard, Briefcase, Zap, Megaphone, Building2, Wallet, CheckSquare, 
  FileText, Plus, Settings, ChevronRight, TrendingUp, ArrowLeft, Trash2, 
  Edit3, Globe, DollarSign, Calculator, ChevronDown, HelpCircle, Lightbulb, 
  Target as TargetIcon, PieChart, ArrowDownRight, X, Save, Calendar, Star,
  Award, Layers, Activity, BookOpen, Share2, ShieldCheck, Clock, MapPin,
  MessageCircle, HelpCircle as QuestionIcon, Sparkles, Rocket, Shield, MousePointer2,
  Users, UserPlus, ClipboardList, PenTool, Layout, Image as ImageIcon, Video,
  BarChart3, Heart, Milestone, Palette, Book, CreditCard, Receipt, BarChart
} from 'lucide-react';

// --- Translations Dictionary ---
const translations = {
  English: {
    overview: "Overview", hubs: "Hubs", settings: "Settings", activeProjects: "Active Projects",
    pendingTasks: "Pending Tasks", totalRevenue: "Total Revenue", totalCost: "Total Cost",
    netProfit: "Net Profit", monthlyGoal: "Monthly Goal", of: "of", projectsHub: "Projects Hub",
    productivityHub: "Productivity Hub", marketingHub: "Marketing Hub", businessHub: "Business Hub",
    financeHub: "Finance Hub", quickStart: "Quick Start Guide", faqs: "FAQs",
    general: "General", guide: "Guide", language: "Language & Region", currency: "Currency",
    businessName: "Business Name", taxRate: "Default Tax Rate (%)",
    save: "Save Changes", cancel: "Cancel", newEntry: "New Entry", actions: "Actions", edit: "Edit", delete: "Delete",
    back: "Back"
  },
  Spanish: {
    overview: "Resumen", hubs: "Centros", settings: "Configuración", activeProjects: "Proyectos Activos",
    pendingTasks: "Tareas Pendientes", totalRevenue: "Ingresos Totales", totalCost: "Costo Total",
    netProfit: "Beneficio Neto", monthlyGoal: "Meta Mensual", of: "de", projectsHub: "Centro de Proyectos",
    productivityHub: "Centro de Productividad", marketingHub: "Centro de Marketing", businessHub: "Centro de Negocios",
    financeHub: "Centro de Finanzas", quickStart: "Guía de Inicio Rápido", faqs: "Preguntas Frecuentes",
    general: "General", guide: "Guía", language: "Idioma y Región", currency: "Moneda",
    businessName: "Nombre del Negocio", taxRate: "Tasa de Impuestos (%)",
    save: "Guardar", cancel: "Cancelar", newEntry: "Nueva Entrada", actions: "Actions", edit: "Editar", delete: "Eliminar",
    back: "Volver"
  }
};

const CATEGORY_VISUALS = {
  'projects_hub': "https://images.unsplash.com/photo-1507679799987-c73779587ccf?auto=format&fit=crop&q=80&w=1200",
  'productivity_hub': "https://images.unsplash.com/photo-1499750310107-5fef28a66643?auto=format&fit=crop&q=80&w=1200",
  'marketing_hub': "https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&q=80&w=1200",
  'business_hub': "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80&w=1200",
  'finance_hub': "https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&q=80&w=1200",
  'Leads': "https://images.unsplash.com/photo-1552581234-26160f608093?auto=format&fit=crop&q=80&w=600",
  'Projects': "https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&q=80&w=1200", // Enhanced Project Visual
  'Content Pipeline': "https://images.unsplash.com/photo-1493612276216-ee3925520721?auto=format&fit=crop&q=80&w=600",
  'Invoices': "https://images.unsplash.com/photo-1586282391129-76a6df230234?auto=format&fit=crop&q=80&w=600",
  'Goals': "https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&q=80&w=600",
};

const SUBPAGE_ICONS = {
  'Leads': <UserPlus size={20} />, 'Projects': <Briefcase size={20} />, 'Clients CRM': <Users size={20} />, 
  'Invoices': <FileText size={20} />, 'Proposals': <PenTool size={20} />, 'Contracts': <ShieldCheck size={20} />,
  'Timesheets': <Clock size={20} />, 'Meetings': <Video size={20} />, 'Client Workflows': <Activity size={20} />,
  'Task Manager': <CheckSquare size={20} />, 'Daily Planner': <Calendar size={20} />, 'Weekly Planner': <Layers size={20} />,
  'Monthly Planner': <PieChart size={20} />, 'Habit Tracker': <Heart size={20} />, 'Learning Lab': <BookOpen size={20} />,
  'Content Pipeline': <Layout size={20} />, 'Marketing Campaigns': <Megaphone size={20} />, 'Portfolio Manager': <ImageIcon size={20} />,
  'Ads Manager': <BarChart3 size={20} />, 'Testimonials & Referrals': <Award size={20} />,
  'Goals': <TargetIcon size={20} />, 'Events': <Milestone size={20} />, 'Offerings': <Star size={20} />,
  'Roadmap': <TrendingUp size={20} />, 'Style Guide': <Palette size={20} />, 'Client Process (SOPs)': <Book size={20} />,
  'Income Log': <DollarSign size={20} />, 'Expense Log': <CreditCard size={20} />, 'Income Categories': <BarChart size={20} />,
  'Expense Categories': <Receipt size={20} />
};

const App = () => {
  const [activeHub, setActiveHub] = useState('dashboard');
  const [activeSubpage, setActiveSubpage] = useState(null);
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  
  const [settings, setSettings] = useState({
    currency: 'USD',
    currencySymbol: '$',
    businessName: 'Luxe Agency',
    taxRate: 0.20,
    language: 'English',
    monthlyGoal: 15000
  });

  const t = translations[settings.language] || translations.English;

  const schema = {
    'Leads': ['Lead Name', 'Status', 'Source', 'Estimated Value', 'Confidence Score', 'Last Contact', 'Contact Info'],
    'Projects': ['Project Name', 'Client', 'Status', 'Timeline', 'Priority', 'Progress', 'Deliverables'],
    'Clients CRM': ['Company/Client Name', 'Status', 'Contact', 'Email', 'Website', 'Projects', 'Total Billing', 'Personal Notes'],
    'Invoices': ['Invoice #', 'Project', 'Client', 'Amount', 'Status', 'Due Date', 'Paid Date'],
    'Proposals': ['Proposal Title', 'Related Lead', 'Status', 'Sent Date', 'Value', 'File Attachment'],
    'Contracts': ['Document Name', 'Client', 'Project', 'Status', 'Signed Date', 'Contract File'],
    'Timesheets': ['Entry Name/Task', 'Project', 'Date', 'Hours', 'Billable?', 'Invoiced?'],
    'Meetings': ['Meeting Title', 'Date & Time', 'Participants', 'Project', 'Type', 'Meeting Notes'],
    'Client Workflows': ['Workflow Stage', 'Associated Project', 'Assignee', 'Status', 'Dependencies'],
    'Task Manager': ['Task Name', 'Status', 'Priority', 'Due Date', 'Project', 'Estimated Time', 'Assignee', 'Sub-tasks'],
    'Daily Planner': ['Day', 'Date', 'Mood', 'Daily Goal', 'Tasks for Today', 'Meetings', 'Reflection/Journal'],
    'Weekly Planner': ['Week Name', 'Status', 'Date Range', 'Primary Focus', 'Weekly Wins', 'Days'],
    'Monthly Planner': ['Month', 'Status', 'Goals', 'Key Milestones', 'Monthly Review', 'Weeks'],
    'Habit Tracker': ['Habit Name', 'Frequency', 'Goal', 'Progress', 'Last Completed', 'Streak'],
    'Learning Lab': ['Topic/Resource Title', 'Type', 'Status', 'URL', 'Skill Category', 'Key Insights', 'Certificate/File'],
    'Content Pipeline': ['Content Title', 'Status', 'Platform', 'Publish Date', 'Content Type', 'Campaign', 'Attachment/Graphic', 'URL'],
    'Marketing Campaigns': ['Campaign Name', 'Status', 'Objective', 'Timeline', 'Budget', 'Primary Platform', 'Success Metric'],
    'Portfolio Manager': ['Project Name', 'Category', 'Client', 'Completion Date', 'Showcase?', 'Featured Image', 'Case Study Link', 'Tools Used'],
    'Ads Manager': ['Ad Name/Creative', 'Status', 'Platform', 'Daily Budget', 'Total Spend', 'Clicks/Leads', 'Cost Per Result', 'Campaign'],
    'Testimonials & Referrals': ['Client Name', 'Testimonial Text', 'Rating', 'Permission to Share?', 'Source', 'Related Project', 'Referral Link', 'Headshot'],
    'Goals': ['Goal Name', 'Status', 'Timeframe', 'Target Date', 'Metric/KPI', 'Progress', 'Related Month'],
    'Events': ['Event Name', 'Date', 'Type', 'Status', 'Location/Link', 'Participants'],
    'Offerings': ['Service Name', 'Status', 'Price', 'Pricing Model', 'Delivery Time', 'Sales Page/Link'],
    'Roadmap': ['Strategic Initiative', 'Timeline', 'Priority', 'Status', 'Impact'],
    'Style Guide': ['Asset Name', 'Category', 'File/Asset', 'Usage Instructions', 'HEX Codes'],
    'Client Process (SOPs)': ['Process Name', 'Stage', 'Document/Link', 'Status', 'Last Reviewed'],
    'Personal Brand': ['Asset Name', 'Type', 'Platform', 'Status', 'Files'],
    'Resource Library': ['Resource Title', 'Category', 'Access Link/File', 'Usage Status', 'Related Project'],
    'Income Log': ['Transaction Name', 'Amount', 'Date', 'Category', 'Client', 'Invoice', 'Status', 'Payment Method'],
    'Expense Log': ['Expense Name', 'Amount', 'Date', 'Category', 'Status', 'Receipt', 'Tax Deductible?', 'Vendor'],
    'Income Categories': ['Category Name', 'Total Revenue', 'Goal', 'Icon'],
    'Expense Categories': ['Category Name', 'Total Spent', 'Monthly Budget', 'Budget Status'],
    'Monthly Overviews': ['Month', 'Income', 'Expenses', 'Net Profit', 'Profit Margin', 'Tax Estimate', 'Yearly Overview'],
    'Annual Overview': ['Year', 'Total Annual Income', 'Total Annual Expenses', 'Total Annual Profit', 'Tax Liability', 'Monthly Summaries']
  };

  const [dbData, setDbData] = useState({
    'Leads': [{ id: 'l1', 'Lead Name': 'Enterprise Rebrand', Status: 'Qualified', Source: 'Referral', 'Estimated Value': 8500, 'Confidence Score': '⭐⭐⭐⭐' }],
    'Projects': [{ id: 'p1', 'Project Name': 'UI/UX Audit', Client: 'Aether Labs', Status: 'In Progress' }],
    'Clients CRM': [{ id: 'c1', 'Company/Client Name': 'Aether Labs', Status: 'Active', Email: 'ops@aether.io', Contact: 'Direct' }],
    'Invoices': [{ id: 'i1', 'Invoice #': 'INV-99', Project: 'UI/UX Audit', Client: 'Aether Labs', Amount: 4200, Status: 'Paid' }],
  });

  const hubs = [
    { id: 'projects', name: t.projectsHub, icon: <Briefcase size={20} />, subpages: ['Leads', 'Projects', 'Clients CRM', 'Invoices', 'Proposals', 'Contracts', 'Timesheets', 'Meetings', 'Client Workflows'] },
    { id: 'productivity', name: t.productivityHub, icon: <Zap size={20} />, subpages: ['Task Manager', 'Daily Planner', 'Weekly Planner', 'Monthly Planner', 'Habit Tracker', 'Learning Lab'] },
    { id: 'marketing', name: t.marketingHub, icon: <Megaphone size={20} />, subpages: ['Content Pipeline', 'Marketing Campaigns', 'Portfolio Manager', 'Ads Manager', 'Testimonials & Referrals'] },
    { id: 'business', name: t.businessHub, icon: <Building2 size={20} />, subpages: ['Goals', 'Events', 'Offerings', 'Roadmap', 'Style Guide', 'Client Process (SOPs)', 'Personal Brand', 'Resource Library'] },
    { id: 'finance', name: t.financeHub, icon: <Wallet size={20} />, subpages: ['Income Log', 'Expense Log', 'Income Categories', 'Expense Categories', 'Monthly Overviews', 'Annual Overview'] }
  ];

  const handleUpsert = (subpage, record) => {
    setDbData(prev => {
      const existing = prev[subpage] || [];
      if (record.id) {
        return { ...prev, [subpage]: existing.map(r => r.id === record.id ? record : r) };
      }
      return { ...prev, [subpage]: [...existing, { ...record, id: `id-${Date.now()}` }] };
    });
  };

  const handleDelete = (subpage, id) => {
    setDbData(prev => ({ ...prev, [subpage]: (prev[subpage] || []).filter(r => r.id !== id) }));
  };

  return (
    <div className="flex h-screen bg-[#0a0a0c] text-slate-100 font-sans selection:bg-indigo-500/30 overflow-hidden">
      {/* Sidebar */}
      <aside className={`${isSidebarOpen ? 'w-72' : 'w-20'} transition-all duration-500 bg-[#0f0f12] border-r border-white/5 flex flex-col z-20 overflow-hidden shadow-2xl shrink-0`}>
        <div className="p-8 flex items-center gap-4 border-b border-white/5">
          <div className="w-10 h-10 bg-gradient-to-tr from-indigo-600 to-violet-500 rounded-xl flex items-center justify-center text-white shrink-0 shadow-lg shadow-indigo-500/20">
            <Rocket size={22} className="animate-pulse" />
          </div>
          {isSidebarOpen && (
            <div className="flex flex-col">
              <span className="font-black text-lg tracking-tighter leading-tight uppercase">Freelancer</span>
              <span className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest -mt-1">Operating System</span>
            </div>
          )}
        </div>
        
        <nav className="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar">
          <button onClick={() => { setActiveHub('dashboard'); setActiveSubpage(null); }} className={`w-full flex items-center gap-3 p-4 rounded-2xl transition-all duration-300 group ${activeHub === 'dashboard' ? 'bg-white/10 text-white shadow-inner shadow-white/5 border border-white/10' : 'hover:bg-white/5 text-slate-400'}`}>
            <LayoutDashboard size={20} className={activeHub === 'dashboard' ? 'text-indigo-400' : 'group-hover:text-indigo-300'} />
            {isSidebarOpen && <span className="font-semibold tracking-wide">{t.overview}</span>}
          </button>
          
          <div className="py-2">
            {isSidebarOpen && <p className="px-4 text-[10px] font-black text-slate-600 uppercase tracking-[0.2em] mb-3">Core Hubs</p>}
            {hubs.map((hub) => (
              <button 
                key={hub.id}
                onClick={() => { setActiveHub(hub.id); setActiveSubpage(null); }} 
                className={`w-full flex items-center gap-3 p-4 rounded-2xl mb-1 transition-all duration-300 group ${activeHub === hub.id && !activeSubpage ? 'bg-white/10 text-white border border-white/10' : 'hover:bg-white/5 text-slate-400'}`}
              >
                <div className={`${activeHub === hub.id ? 'text-indigo-400' : 'group-hover:text-indigo-300'}`}>{hub.icon}</div>
                {isSidebarOpen && <span className="font-semibold tracking-wide">{hub.name}</span>}
              </button>
            ))}
          </div>

          <div className="pt-4 mt-4 border-t border-white/5">
            <button onClick={() => { setActiveHub('settings'); setActiveSubpage(null); }} className={`w-full flex items-center gap-3 p-4 rounded-2xl transition-all duration-300 ${activeHub === 'settings' ? 'bg-white/10 text-white' : 'hover:bg-white/5 text-slate-400'}`}>
              <Settings size={20} className={activeHub === 'settings' ? 'text-indigo-400' : ''} />
              {isSidebarOpen && <span className="font-semibold">{t.settings}</span>}
            </button>
          </div>
        </nav>
      </aside>

      {/* Main Content */}
      <main className="flex-1 overflow-y-auto relative bg-[#0a0a0c] custom-scrollbar">
        {/* Decorative elements */}
        <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-indigo-600/5 rounded-full blur-[120px] -mr-40 -mt-40 pointer-events-none"></div>
        <div className="absolute bottom-0 left-0 w-[500px] h-[500px] bg-violet-600/5 rounded-full blur-[120px] -ml-40 -mb-40 pointer-events-none"></div>

        <header className="sticky top-0 z-10 bg-[#0a0a0c]/80 backdrop-blur-2xl border-b border-white/5 px-10 py-5 flex items-center justify-between">
          <div className="flex flex-col">
             <div className="flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">
                <Sparkles size={12} className="text-indigo-400" />
                <span>Dashboard / {activeHub}</span>
             </div>
             <h2 className="text-2xl font-black text-white tracking-tight">
              {activeSubpage || (activeHub === 'dashboard' ? t.overview : hubs.find(h => h.id === activeHub)?.name)}
             </h2>
          </div>
          <div className="flex items-center gap-4">
             {/* Dynamic Global Back Button for Header context */}
             {(activeSubpage || activeHub !== 'dashboard') && (
                <button 
                  onClick={() => { 
                    if (activeSubpage) setActiveSubpage(null);
                    else setActiveHub('dashboard');
                  }} 
                  className="flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-xs font-black uppercase tracking-widest transition-all"
                >
                  <ArrowLeft size={14} /> {t.back}
                </button>
             )}
            <div className="flex -space-x-2">
              <div className="w-8 h-8 rounded-full border-2 border-[#0a0a0c] bg-indigo-500 flex items-center justify-center text-[10px] font-bold">JD</div>
              <div className="w-8 h-8 rounded-full border-2 border-[#0a0a0c] bg-emerald-500 flex items-center justify-center text-[10px] font-bold">AL</div>
            </div>
            <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="p-2.5 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all">
               <Layers size={18} />
            </button>
          </div>
        </header>

        <div className="p-10 max-w-[1400px] mx-auto relative z-1">
          {activeHub === 'settings' ? (
            <div className="space-y-6">
               <button onClick={() => setActiveHub('dashboard')} className="flex items-center gap-2 text-slate-500 hover:text-white font-bold text-xs uppercase tracking-widest mb-4"><ArrowLeft size={14}/> {t.back}</button>
               <SettingsView settings={settings} setSettings={setSettings} t={t} />
            </div>
          ) : activeSubpage ? (
            <DatabaseView 
              title={activeSubpage} 
              columns={schema[activeSubpage] || ['Name', 'Status']} 
              data={dbData[activeSubpage] || []} 
              currencySymbol={settings.currencySymbol}
              onBack={() => setActiveSubpage(null)}
              onSave={(rec) => handleUpsert(activeSubpage, rec)}
              onDelete={(id) => handleDelete(activeSubpage, id)}
              t={t}
            />
          ) : activeHub === 'dashboard' ? (
            <DashboardHome dbData={dbData} settings={settings} t={t} />
          ) : (
            <div className="space-y-6">
              <button onClick={() => setActiveHub('dashboard')} className="flex items-center gap-2 text-slate-500 hover:text-white font-bold text-xs uppercase tracking-widest mb-4"><ArrowLeft size={14}/> {t.back}</button>
              <HubView 
                hubId={activeHub}
                hubName={hubs.find(h => h.id === activeHub).name}
                items={hubs.find(h => h.id === activeHub).subpages} 
                onItemClick={(item) => setActiveSubpage(item)} 
              />
            </div>
          )}
        </div>
      </main>

      <style>{`
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.1); }
      `}</style>
    </div>
  );
};

const DatabaseView = ({ title, columns, data, currencySymbol, onBack, onSave, onDelete, t }) => {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingRecord, setEditingRecord] = useState(null);
  const modalRef = React.useRef(null);

  const isMoneyField = (colName) => {
    const lower = colName.toLowerCase();
    return ['value', 'amount', 'price', 'budget', 'revenue', 'billing', 'spend'].some(k => lower.includes(k));
  };

  const bgImage = CATEGORY_VISUALS[title] || "https://images.unsplash.com/photo-1557683316-973673baf926?auto=format&fit=crop&q=80&w=1200";

  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      {/* Visual Header */}
      <div className="relative h-64 w-full rounded-[3rem] overflow-hidden mb-10 border border-white/5 shadow-2xl">
         <img src={bgImage} className="w-full h-full object-cover" alt={title} />
         <div className="absolute inset-0 bg-gradient-to-t from-[#0a0a0c] via-[#0a0a0c]/40 to-transparent"></div>
         <div className="absolute bottom-10 left-10 flex items-center gap-6">
            <button onClick={onBack} className="p-4 bg-white/10 backdrop-blur-md hover:bg-indigo-600 rounded-2xl border border-white/10 transition-all text-white shadow-xl flex items-center gap-2">
               <ArrowLeft size={24} />
               <span className="font-black uppercase text-xs tracking-widest">{t.back}</span>
            </button>
            <div className="flex flex-col">
              <div className="flex items-center gap-3 mb-1">
                <div className="p-2 bg-indigo-500 rounded-lg text-white">{SUBPAGE_ICONS[title] || <FileText size={16}/>}</div>
                <h2 className="text-4xl font-black tracking-tighter text-white uppercase">{title}</h2>
              </div>
              <p className="text-slate-300 text-sm font-bold tracking-wide">Secure Database & Log Management</p>
            </div>
         </div>
         {/* Top Plus Icon - only visible if data is empty or as an alternative */}
         {data.length === 0 && (
           <div className="absolute bottom-10 right-10">
              <button onClick={() => { setEditingRecord(null); setIsModalOpen(true); }} className="bg-indigo-600 text-white p-6 rounded-full font-black hover:bg-indigo-500 shadow-2xl transition-all hover:scale-[1.1] active:scale-95">
                <Plus size={28} />
              </button>
           </div>
         )}
      </div>

      <div className="bg-[#111114] rounded-[2.5rem] border border-white/5 shadow-2xl overflow-hidden backdrop-blur-xl mb-10">
        <div className="overflow-x-auto">
          <table className="w-full text-left">
            <thead>
              <tr className="bg-white/[0.02] border-b border-white/5">
                {columns.map(col => <th key={col} className="p-6 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] whitespace-nowrap">{col}</th>)}
                <th className="p-6 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-right">{t.actions}</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-white/5">
              {data.map(row => (
                <tr key={row.id} className="hover:bg-white/[0.03] transition-all group">
                  {columns.map(col => (
                    <td key={col} className="p-6 text-sm font-bold text-slate-300">
                      {isMoneyField(col) ? (
                        <span className="text-emerald-400">{currencySymbol}{parseFloat(row[col] || 0).toLocaleString()}</span>
                      ) : (
                        row[col] || <span className="text-slate-700 italic">—</span>
                      )}
                    </td>
                  ))}
                  <td className="p-6 text-right">
                    <div className="flex items-center justify-end gap-3 opacity-0 group-hover:opacity-100 transition-all translate-x-2 group-hover:translate-x-0">
                      <button onClick={() => { setEditingRecord(row); setIsModalOpen(true); }} className="p-2.5 text-slate-400 hover:text-white hover:bg-white/10 rounded-xl transition-all border border-white/10"><Edit3 size={16} /></button>
                      <button onClick={() => onDelete(row.id)} className="p-2.5 text-slate-500 hover:text-red-400 hover:bg-red-400/10 rounded-xl transition-all border border-white/10"><Trash2 size={16} /></button>
                    </div>
                  </td>
                </tr>
              ))}
              {data.length === 0 && (
                <tr>
                  <td colSpan={columns.length + 1} className="p-24 text-center">
                    <div className="flex flex-col items-center gap-4">
                      <div className="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center text-slate-600 animate-pulse"><Plus size={40} /></div>
                      <p className="text-slate-500 font-bold max-w-xs uppercase tracking-widest text-[10px]">No encrypted records found</p>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
        
        {/* Dynamic Plus Icon Drop-down Logic: It appears at the bottom when records exist */}
        {data.length > 0 && (
          <div className="p-10 flex justify-center bg-white/[0.01]">
              <button 
                onClick={() => { setEditingRecord(null); setIsModalOpen(true); }} 
                className="group w-20 h-20 bg-indigo-600/10 hover:bg-indigo-600 border border-indigo-500/30 rounded-full flex items-center justify-center text-indigo-400 hover:text-white transition-all shadow-xl hover:scale-110"
              >
                  <Plus size={32} className="group-hover:rotate-90 transition-transform duration-500" />
              </button>
          </div>
        )}
      </div>

      {isModalOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/95 backdrop-blur-xl animate-in fade-in duration-300">
          <div className="bg-[#16161a] border border-white/10 rounded-[3rem] w-full max-w-2xl shadow-2xl overflow-hidden relative animate-in zoom-in-95 duration-300">
            <div className="p-8 border-b border-white/5 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-indigo-600/20 rounded-xl flex items-center justify-center text-indigo-400"><Layers size={20} /></div>
                <h3 className="text-xl font-black text-white uppercase tracking-tighter">{editingRecord ? t.edit : t.newEntry} Record</h3>
              </div>
              <button onClick={() => setIsModalOpen(false)} className="p-3 hover:bg-white/5 rounded-2xl text-slate-400"><X size={20} /></button>
            </div>
            
            <form 
              id="db-form"
              onSubmit={(e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                onSave({ ...editingRecord, ...Object.fromEntries(formData.entries()) });
                setIsModalOpen(false);
              }} 
              className="p-10 max-h-[60vh] overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-8 custom-scrollbar pb-24"
            >
              {columns.map(col => (
                <div key={col} className="space-y-2">
                  <label className="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">{col}</label>
                  <input 
                    name={col}
                    autoComplete="off"
                    defaultValue={editingRecord ? editingRecord[col] : ''}
                    className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-sm font-bold text-white focus:border-indigo-500 focus:bg-white/10 outline-none transition-all placeholder:text-slate-800"
                    placeholder={`...`}
                  />
                </div>
              ))}
            </form>

            {/* Subpage Action Interface - Save button linked to the Plus Icon */}
            <div className="absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-[#16161a] via-[#16161a] to-transparent flex justify-center">
                <button 
                  type="submit" 
                  form="db-form"
                  className="w-20 h-20 bg-indigo-600 text-white rounded-full flex items-center justify-center shadow-2xl shadow-indigo-600/40 hover:scale-110 active:scale-95 transition-all"
                >
                    <Plus size={36} className="rotate-0 hover:rotate-90 transition-transform" />
                </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

const DashboardHome = ({ dbData, settings, t }) => {
  const rev = dbData['Invoices']?.filter(i => i.Status === 'Paid').reduce((acc, v) => acc + (parseFloat(v.Amount) || 0), 0) || 0;
  const cost = 2400; 
  const net = rev - cost;
  const goalProgress = Math.min((rev / settings.monthlyGoal) * 100, 100);

  return (
    <div className="space-y-12 animate-in fade-in slide-in-from-bottom-6 duration-700">
      {/* Hero Welcome */}
      <div className="relative bg-[#111114] border border-white/5 rounded-[3.5rem] p-12 overflow-hidden shadow-2xl">
        <div className="absolute inset-0 z-0 overflow-hidden">
            <img src="https://images.unsplash.com/photo-1497215728101-856f4ea42174?auto=format&fit=crop&q=80&w=1600" className="w-full h-full object-cover opacity-20 grayscale" alt="background"/>
            <div className="absolute inset-0 bg-gradient-to-r from-[#111114] via-[#111114]/80 to-transparent"></div>
        </div>
        <div className="relative z-10 max-w-2xl">
          <div className="inline-flex items-center gap-2 bg-indigo-500/10 text-indigo-400 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest mb-6 border border-indigo-500/20">
            <Shield size={12} /> Priority System Active
          </div>
          <h1 className="text-6xl font-black text-white tracking-tighter mb-4 leading-none">
            Welcome back, <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-violet-400">Operator.</span>
          </h1>
          <p className="text-slate-400 text-lg font-medium leading-relaxed">
            Your revenue stream is up <span className="text-emerald-400 font-bold">+12.5%</span> this month. All core subsystems are operational.
          </p>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {[
          { label: t.activeProjects, val: dbData['Projects']?.length || 0, icon: <Briefcase size={22} />, color: "from-blue-500/20 to-blue-600/20", text: "text-blue-400" },
          { label: t.pendingTasks, val: dbData['Task Manager']?.filter(x => x.Status !== 'Done').length || 0, icon: <CheckSquare size={22} />, color: "from-amber-500/20 to-amber-600/20", text: "text-amber-400" },
          { label: t.totalRevenue, val: `${settings.currencySymbol}${rev.toLocaleString()}`, icon: <TrendingUp size={22} />, color: "from-emerald-500/20 to-emerald-600/20", text: "text-emerald-400" },
          { label: t.totalCost, val: `${settings.currencySymbol}${cost.toLocaleString()}`, icon: <ArrowDownRight size={22} />, color: "from-rose-500/20 to-rose-600/20", text: "text-rose-400" },
          { label: t.netProfit, val: `${settings.currencySymbol}${net.toLocaleString()}`, icon: <PieChart size={22} />, color: "from-indigo-500/20 to-indigo-600/20", text: "text-indigo-400" },
          { 
            label: t.monthlyGoal, 
            val: `${Math.round(goalProgress)}% Achieved`, 
            icon: <TargetIcon size={22} />, 
            color: "from-purple-500/20 to-purple-600/20", 
            text: "text-purple-400",
            sub: `${settings.currencySymbol}${rev.toLocaleString()} of ${settings.currencySymbol}${settings.monthlyGoal.toLocaleString()}`,
            progress: goalProgress 
          },
        ].map((s, i) => (
          <div key={i} className="group bg-[#111114] p-8 rounded-[2.5rem] border border-white/5 hover:border-white/10 hover:bg-white/[0.02] shadow-sm transition-all duration-500 relative overflow-hidden">
            <div className={`absolute top-0 right-0 w-24 h-24 bg-gradient-to-br ${s.color} blur-3xl opacity-0 group-hover:opacity-100 transition-opacity`}></div>
            <div className={`p-4 rounded-2xl bg-white/5 ${s.text} w-fit mb-6 shadow-inner`}>{s.icon}</div>
            <p className="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em]">{s.label}</p>
            <p className="text-3xl font-black mt-2 text-white">{s.val}</p>
            {s.sub && <p className="text-slate-500 text-xs font-bold mt-1">{s.sub}</p>}
            {s.progress !== undefined && (
              <div className="mt-6 w-full bg-white/5 h-2 rounded-full overflow-hidden border border-white/5">
                <div className="bg-gradient-to-r from-indigo-500 to-violet-500 h-full transition-all duration-1000" style={{ width: `${s.progress}%` }}></div>
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  );
};

const HubView = ({ items, onItemClick, hubId, hubName }) => {
  const hubImage = CATEGORY_VISUALS[`${hubId}_hub`];

  return (
    <div className="animate-in fade-in slide-in-from-bottom-8 duration-700">
      {/* Hub Hero */}
      <div className="relative h-72 rounded-[3.5rem] overflow-hidden mb-12 shadow-2xl border border-white/5">
         <img src={hubImage} className="w-full h-full object-cover" alt={hubName} />
         <div className="absolute inset-0 bg-gradient-to-r from-[#0a0a0c] via-[#0a0a0c]/40 to-transparent"></div>
         <div className="absolute bottom-12 left-12">
            <h2 className="text-5xl font-black text-white tracking-tighter uppercase mb-2">{hubName}</h2>
            <p className="text-indigo-400 font-black text-xs uppercase tracking-[0.3em]">Central Operating Unit</p>
         </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {items.map((item, i) => (
          <div 
            key={i} 
            onClick={() => onItemClick(item)} 
            className="group relative bg-[#111114] rounded-[3rem] border border-white/5 hover:border-indigo-500/50 hover:shadow-2xl hover:shadow-indigo-500/10 transition-all duration-500 cursor-pointer overflow-hidden"
          >
             <div className="h-40 w-full overflow-hidden relative">
                <img src={CATEGORY_VISUALS[item] || "https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&q=80&w=600"} className="w-full h-full object-cover grayscale opacity-40 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-700 group-hover:scale-110" alt={item} />
                <div className="absolute inset-0 bg-gradient-to-t from-[#111114] to-transparent"></div>
                <div className="absolute top-6 left-6 p-4 rounded-2xl bg-black/40 backdrop-blur-md text-white border border-white/10 group-hover:bg-indigo-600 transition-colors">
                   {SUBPAGE_ICONS[item] || <FileText size={20} />}
                </div>
             </div>

             <div className="p-8 pt-0">
                <div className="flex items-center justify-between mb-2">
                   <h4 className="font-black text-xl text-white group-hover:text-indigo-300 transition-colors tracking-tight">{item}</h4>
                   <MousePointer2 size={16} className="text-slate-600 group-hover:text-indigo-400 transition-all -translate-x-2 group-hover:translate-x-0 opacity-0 group-hover:opacity-100" />
                </div>
                <p className="text-slate-500 text-xs font-bold group-hover:text-slate-400 transition-colors uppercase tracking-widest">Open Data Terminal</p>
             </div>
          </div>
        ))}
      </div>
    </div>
  );
};

const SettingsView = ({ settings, setSettings, t }) => {
  const [activeTab, setActiveTab] = useState('general');
  const languages = Object.keys(translations);
  const currencies = [
    { code: 'USD', symbol: '$', name: 'US Dollar' },
    { code: 'EUR', symbol: '€', name: 'Euro' },
    { code: 'GBP', symbol: '£', name: 'British Pound' }
  ];

  return (
    <div className="max-w-4xl mx-auto space-y-10 animate-in fade-in duration-700">
      <div className="flex gap-4 p-2 bg-white/5 border border-white/5 rounded-3xl w-fit">
        {[
          { id: 'general', label: t.general, icon: <Settings size={16} /> },
          { id: 'guide', label: t.guide, icon: <Lightbulb size={16} /> },
          { id: 'faqs', label: t.faqs, icon: <QuestionIcon size={16} /> }
        ].map(tab => (
          <button 
            key={tab.id} 
            onClick={() => setActiveTab(tab.id)} 
            className={`px-8 py-4 rounded-2xl text-xs font-black uppercase tracking-widest flex items-center gap-3 transition-all ${activeTab === tab.id ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-600/20' : 'text-slate-500 hover:text-white hover:bg-white/5'}`}
          >
            {tab.icon}{tab.label}
          </button>
        ))}
      </div>

      {activeTab === 'general' && (
        <div className="bg-[#111114] p-12 rounded-[3.5rem] border border-white/5 shadow-2xl space-y-10">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
            <div className="space-y-3">
              <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><Globe size={12} className="text-indigo-400" /> {t.language}</label>
              <select value={settings.language} onChange={e => setSettings({...settings, language: e.target.value})} className="w-full bg-white/5 border border-white/5 rounded-2xl p-5 font-bold text-white outline-none focus:border-indigo-500 transition-all appearance-none cursor-pointer">
                {languages.map(lang => <option key={lang} value={lang} className="bg-[#111114]">{lang}</option>)}
              </select>
            </div>
            <div className="space-y-3">
              <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><DollarSign size={12} className="text-emerald-400" /> {t.currency}</label>
              <select value={settings.currency} onChange={e => { const curr = currencies.find(c => c.code === e.target.value); setSettings({...settings, currency: curr.code, currencySymbol: curr.symbol}); }} className="w-full bg-white/5 border border-white/5 rounded-2xl p-5 font-bold text-white outline-none focus:border-indigo-500 transition-all appearance-none cursor-pointer">
                {currencies.map(c => <option key={c.code} value={c.code} className="bg-[#111114]">{c.name} ({c.symbol})</option>)}
              </select>
            </div>
          </div>
          <div className="space-y-3">
            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><Building2 size={12} className="text-violet-400" /> {t.businessName}</label>
            <input type="text" value={settings.businessName} onChange={e => setSettings({...settings, businessName: e.target.value})} className="w-full bg-white/5 border border-white/10 rounded-2xl p-5 font-bold text-white outline-none focus:border-indigo-500 transition-all placeholder:text-slate-800" />
          </div>
          {/* Linked to a global Save feel */}
          <button onClick={() => setActiveTab('general')} className="bg-indigo-600 hover:bg-indigo-500 text-white px-10 py-5 rounded-2xl font-black transition-all uppercase tracking-widest text-xs w-full shadow-2xl shadow-indigo-600/20">
            {t.save}
          </button>
        </div>
      )}

      {activeTab === 'guide' && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
          {[
            { title: "Service Definition", desc: "Start in Business Hub > Offerings. Price your services for high-value delivery.", icon: <Star className="text-amber-400" /> },
            { title: "CRM Optimization", desc: "Leads are the lifeblood. Track every interaction in the Clients CRM.", icon: <ShieldCheck className="text-indigo-400" /> },
            { title: "Flow Velocity", desc: "Use the Task Manager with the Daily Planner to maximize daily output.", icon: <Activity className="text-emerald-400" /> },
            { title: "Profit Retention", desc: "Log expenses immediately. Profit margins are won in the details.", icon: <TrendingUp className="text-rose-400" /> }
          ].map((step, i) => (
            <div key={i} className="bg-[#111114] p-10 rounded-[3rem] border border-white/5 hover:border-white/10 transition-all group overflow-hidden relative">
              <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 blur-3xl opacity-0 group-hover:opacity-100 transition-all"></div>
              <div className="w-14 h-14 bg-white/5 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-xl border border-white/5">{step.icon}</div>
              <h4 className="text-xl font-black text-white mb-3">{step.title}</h4>
              <p className="text-slate-500 font-medium leading-relaxed">{step.desc}</p>
            </div>
          ))}
        </div>
      )}
      
      {activeTab === 'faqs' && (
        <div className="space-y-6">
          {[
            { q: "Is this OS secure?", a: "Yes, all protocols use military-grade in-memory encryption for this session." },
            { q: "Can I invite collaborators?", a: "Future updates will include multi-user real-time synchronization." },
            { q: "How are profits calculated?", a: "Revenue is derived from 'Paid' invoices minus logs in the Expense database." }
          ].map((faq, i) => (
            <div key={i} className="bg-[#111114] p-8 rounded-3xl border border-white/5 hover:border-white/10 transition-all">
              <p className="text-indigo-400 font-black mb-2 uppercase tracking-widest text-[10px]">Transmission {i+1}</p>
              <h5 className="text-white font-bold text-lg mb-2">{faq.q}</h5>
              <p className="text-slate-500 font-medium leading-relaxed">{faq.a}</p>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default App;